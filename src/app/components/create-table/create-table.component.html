<div class="container">
  <div class="form-card">
    <h2>ğŸ› ï¸ Tablo YÃ¶netimi</h2>

    <!-- âœ… Tablo Silme -->
    <div class="section">
      <h3>ğŸ—‘ï¸ Tablo Sil</h3>
      <div class="form-inline">
        <select [(ngModel)]="selectedTableToDelete">
          <option value="" disabled selected>Silinecek tabloyu seÃ§in</option>
          <option *ngFor="let table of tableNames" [value]="table">{{ table }}</option>
        </select>
        <button class="btn danger" (click)="deleteTable()">Sil</button>
      </div>
    </div>

    <!-- âœ… Tablo OluÅŸtur -->
    <div class="section">
      <h3>ğŸ“Œ Yeni Tablo Ekle</h3>
      <div class="form-group">
        <label>Tablo AdÄ±:</label>
        <input type="text" [(ngModel)]="tableName" placeholder="Tablo adÄ± girin">
      </div>

      <!-- âœ… SÃ¼tun Ekleme -->
      <h3>ğŸ“Š SÃ¼tunlar</h3>
      <div class="form-inline">
        <input type="text" [(ngModel)]="columnName" placeholder="SÃ¼tun adÄ±">
        <select [(ngModel)]="columnType">
          <option value="varchar">VARCHAR</option>
          <option value="number">INTEGER</option>
          <option value="date">DATE</option>
          <option value="boolean">BOOLEAN</option>
        </select>
        <button class="btn primary" (click)="addColumn()">Ekle</button>
      </div>

      <ul class="list">
        <li *ngFor="let col of columns; let i = index">
          <span>{{ col.key }} ({{ col.type }})</span>
          <button class="btn danger" (click)="removeColumn(i)">Sil</button>
        </li>
      </ul>

      <!-- âœ… Foreign Key (BaÄŸlantÄ±lar) -->
      <h3>ğŸ”— Ä°liÅŸkisel BaÄŸlantÄ±lar</h3>
      <div class="form-inline">
        <select [(ngModel)]="selectedForeignTable" (change)="loadForeignTableColumns()">
          <option value="" disabled selected>Tablo SeÃ§</option>
          <option *ngFor="let table of tableNames" [value]="table">{{ table }}</option>
        </select>

        <select [(ngModel)]="selectedRelation">
          <option value="one-to-many">One-to-Many</option>
          <option value="many-to-many">Many-to-Many</option>
        </select>

        <select *ngIf="foreignTableColumns.length > 0" [(ngModel)]="selectedForeignColumn">
          <option value="" disabled selected>Kolon SeÃ§</option>
          <option *ngFor="let col of foreignTableColumns" [value]="col">{{ col }}</option>
        </select>

        <button class="btn join" [disabled]="!selectedForeignTable || !selectedForeignColumn" (click)="addForeignKey()">BaÄŸla</button>
      </div>

      <ul class="list">
        <li *ngFor="let fk of foreignKeys; let i = index">
          <span>{{ fk.column }} â†’ {{ fk.references }} ({{ fk.relation }}) [Kolon: {{ fk.relationColumn }}]</span>
          <button class="btn danger" (click)="removeForeignKey(i)">Sil</button>
        </li>
      </ul>

      <!-- âœ… Alarm Kur -->
      <h3>â° Alarm Kur</h3>
      <label class="checkbox">
        <input type="checkbox" [(ngModel)]="enableAlarm" (change)="toggleAlarm()">
        Alarm Kur
      </label>

      <!-- âœ… Tablo OluÅŸtur Butonu -->
      <button class="btn success full-width" (click)="createTable()">âœ… Tablo OluÅŸtur</button>
    </div>

    <!-- âœ… Tablo Ã–nizleme -->
    <div *ngIf="showTablePreview" class="preview">
      <h3>ğŸ“Š {{ tableName }} Tablosu</h3>
      <table>
        <thead>
          <tr>
            <th *ngFor="let col of columns">{{ col.key }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of previewData">
            <td *ngFor="let col of columns">
              <input type="text" [(ngModel)]="row[col.key]">
            </td>
          </tr>
        </tbody>
      </table>
      <button class="btn add-row" (click)="addNewRow()">â• SatÄ±r Ekle</button>
    </div>

    <!-- âœ… OluÅŸturulan Tablo DetaylarÄ± -->
    <div *ngIf="createdTableDetails" class="created-table-info">
      <h3>âœ… OluÅŸturulan Tablo: {{ createdTableDetails.tableName }}</h3>

      <h4>ğŸ“Œ Kolonlar</h4>
      <ul>
        <li *ngFor="let column of createdTableDetails.columns">
          {{ column.key }} - {{ column.type }}
        </li>
      </ul>

      <h4>ğŸ”— YabancÄ± Anahtarlar</h4>
      <ul *ngIf="createdTableDetails.foreignKeys.length">
        <li *ngFor="let fk of createdTableDetails.foreignKeys">
          {{ fk.column }} â†’ {{ fk.references }} ({{ fk.relation }})
        </li>
      </ul>

      <h4>â° Alarm Durumu: {{ createdTableDetails.enableAlarm ? 'Aktif' : 'Pasif' }}</h4>
    </div>

  </div>
</div>
